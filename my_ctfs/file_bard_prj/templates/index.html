<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WhatsApp Group Personality Analyzer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      text-align: center;
    }
    #uploadForm {
      margin-top: 2rem;
    }
    #instructions {
      margin: 2rem auto;
      max-width: 600px;
      text-align: left;
    }
    #loading, #result {
      display: none;
      margin-top: 2rem;
      font-size: 1.2rem;
      color: #555;
    }
    .option-group {
      text-align: left;
      margin: 1rem auto;
      display: inline-block;
      text-align: left;
    }
    #usernameInput {
      display: none;
      margin-top: 1rem;
    }
    #usernameInput input {
      padding: 0.5rem;
      width: 100%;
      max-width: 300px;
      box-sizing: border-box;
    }
    #dateInputs input {
      padding: 0.5rem;
      width: 150px;
      box-sizing: border-box;
    }
  </style>
</head>
<body>

  <h1>WhatsApp Group Personality Analyzer</h1>
  <p>Upload your exported WhatsApp group chat file to get a summary of the personalities involved!</p>

  <div id="instructions">
    <h3>How to Export a WhatsApp Group Chat:</h3>
    <ol>
      <li>Open WhatsApp and go to the group chat you want to export.</li>
      <li>Tap the group name at the top to open Group Info.</li>
      <li>Scroll down and tap <strong>Export chat</strong>.</li>
      <li>Select <strong>Without Media</strong>.</li>
      <li>Choose a way to save or share the .txt file (e.g., email it to yourself).</li>
      <li>Save the .txt file to your computer or device and upload it below.</li>
    </ol>
  </div>

  <form id="uploadForm">
    <div class="option-group">
      <label><input type="radio" name="option" value="1" checked> 1. Summarize personalities of group users</label><br>
      <label><input type="radio" name="option" value="2"> 2. Summarize personality of one specific user (more accurate)</label><br>
      <label><input type="radio" name="option" value="3"> 3. Conflict Detection (arguments, passive-aggressiveness, ghosting)</label><br>
      <label><input type="radio" name="option" value="4"> 4. Detect sarcastic or toxic interactions</label><br>
      <label><input type="radio" name="option" value="5"> 5. Statistics Leaderboard. XXX Who talks the most, who starts conversations</label><br>
    </div>

    <div id="usernameInput">
      <input type="text" id="username" name="username" placeholder="Enter specific username (case-sensitive, as it appears in the chat)" />
    </div>

    <div class="option-group">
      <label><input type="checkbox" id="dateRangeToggle"> Analyze specific date range</label>
      <div id="dateInputs" style="display: none; margin-top: 1rem;">
        <label>From: <input type="text" id="startDate" name="startDate" placeholder="dd/mm/yyyy" /></label><br><br>
        <label>Until: <input type="text" id="endDate" name="endDate" placeholder="dd/mm/yyyy" /></label>
      </div>
    </div>

    <br>
    <input type="file" id="chatfile" name="chatfile" accept=".txt" required />
    <br><br>
    <button type="submit">Upload & Analyze</button>
  </form>

  <div id="loading">
    <p>Processing chat... please wait while we analyze the personalities ??</p>
  </div>

  <div id="result"></div>

  <script>
    const optionRadios = document.getElementsByName('option');
    const usernameInput = document.getElementById('usernameInput');

    optionRadios.forEach(radio => {
      radio.addEventListener('change', () => {
        if (radio.value === '2') {
          usernameInput.style.display = 'block';
        } else {
          usernameInput.style.display = 'none';
        }
      });
    });

    const dateToggle = document.getElementById('dateRangeToggle');
    const dateInputs = document.getElementById('dateInputs');
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');

    function getTodayDate() {
      const today = new Date();
      const dd = String(today.getDate()).padStart(2, '0');
      const mm = String(today.getMonth() + 1).padStart(2, '0');
      const yyyy = today.getFullYear();
      return `${dd}.${mm}.${yyyy}`;
    }

    dateToggle.addEventListener('change', () => {
      if (dateToggle.checked) {
        dateInputs.style.display = 'block';
        const today = getTodayDate();
        startDateInput.value = today;
        endDateInput.value = today;
      } else {
        dateInputs.style.display = 'none';
        startDateInput.value = '';
        endDateInput.value = '';
      }
    });

    document.getElementById('uploadForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const fileInput = document.getElementById('chatfile');
      const file = fileInput.files[0];
      const selectedOption = document.querySelector('input[name="option"]:checked').value;
      const username = document.getElementById('username').value;

      if (!file) return;

      const formData = new FormData();
      formData.append('chatfile', file);
      formData.append('option', selectedOption);
      if (selectedOption === '2') {
        formData.append('username', username);
      }
      if (dateToggle.checked) {
        formData.append('startDate', startDateInput.value);
        formData.append('endDate', endDateInput.value);
      }

      document.getElementById('uploadForm').style.display = 'none';
      document.getElementById('instructions').style.display = 'none';
      document.getElementById('loading').style.display = 'block';

      fetch('/upload', {
        method: 'POST',
        body: formData
      })
      .then(response => response.text())
      .then(data => {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('result').style.display = 'block';
        document.getElementById('result').innerHTML = `<strong>Result:</strong> ${data}`;
      })
      .catch(err => {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('result').style.display = 'block';
        document.getElementById('result').innerHTML = `Something went wrong: ${err}`;
      });
    });
  </script>

</body>
</html>
